<Project>
  <!--
    WinUI関連の設定
    MAUIからも参照されるので注意する。
  -->

  <PropertyGroup>
    <IsPublishable>true</IsPublishable>
    <TargetPlatformMinVersion>10.0.19041.0</TargetPlatformMinVersion>
  </PropertyGroup>

  <Import Project="$(BuildCommonDirectory)/Trimming.targets" />
  <Import Project="$(BuildCommonDirectory)/ReadyToRun.targets" />
  <Import Project="$(BuildCommonDirectory)/SingleFile.targets" />
  <Import Project="$(BuildCommonDirectory)/Runtime.targets" />

  <PropertyGroup>
    <InvariantGlobalization>false</InvariantGlobalization>

    <!-- trueだと実行時エラーとなる。 -->
    <IsTrimmable>false</IsTrimmable>
  </PropertyGroup>

  <!--
    WinUIに必要なパッケージを参照する。
    MAUIではSDKで自動的に参照されるため、重複して参照しないように注意する。
  -->
  <ItemGroup Condition="'$(UsingMicrosoftMauiSdk)' != 'true'">
    <PackageReference Include="Microsoft.WindowsAppSDK" Version="*" />
    <PackageReference Include="Microsoft.Windows.SDK.BuildTools" Version="*" />
  </ItemGroup>

  <!-- WinUI関連の検証を行うターゲット。 -->
  <Target Name="CheckWinUI" BeforeTargets="BeforeBuild">
    <!--
      .NET 7ではPublishTrimmedをtrueにすると、実行時エラーとなる。
      そのため、.NET 6を強制する。
    -->
    <Error Condition="!$(TargetFramework.StartsWith('net6.0'))" Text="TargetFramework must be .NET 6." />

    <!--
      EnableMsixToolingは、Directory.Build.targetsだけでtrueに設定した場合、Microsoft.Build.Packaging.Pri.Tasks.ExpandPriContentタスクを読み込めずコンパイルエラーとなる。
      そのため、csprojまたはDirectory.Build.propsでtrueに設定する必要がある。
      Directory.Build.propsでは出力ファイルの種類やフレームワークでの分岐はできないため、EnableMsixToolingの設定を共通化できない。
      csprojでの設定を強制する必要があるため、true以外の場合はコンパイルエラーとする。
    -->
    <Error Condition="'$(EnableMsixTooling)' != 'true'" Text="EnableMsixTooling must be true." />

    <!--
      WindowsPackageType（非パッケージアプリを出力する）は、Directory.Build.targetsだけでNoneに設定した場合、コンパイルエラーとなる。
      AppxPackageをfalseに設定することでコンパイルエラーを回避できるが、念のためcsprojまたはDirectory.Build.propsでNoneに設定する。
      Directory.Build.propsでは出力ファイルの種類やフレームワークでの分岐はできないため、WindowsPackageTypeの設定を共通化できない。
      csprojでの設定を強制する必要があるため、None以外の場合はコンパイルエラーとする。
    -->
    <Error Condition="'$(WindowsPackageType)' != 'None'" Text="WindowsPackageType must be None." />

    <!--
      WindowsAppSDKSelfContained（自己完結型WinUIアプリを出力する）はDirectory.Build.targetsだけでtrueに設定した場合、実行時エラーとなる。
      そのため、csprojまたはDirectory.Build.propsでtrueに設定する必要がある。
      Directory.Build.propsでは出力ファイルの種類やフレームワークでの分岐はできないため、WindowsAppSDKSelfContainedの設定を共通化できない。
      csprojでの設定を強制する必要があるため、true以外の場合はコンパイルエラーとする。
    -->
    <Error Condition="'$(WindowsAppSDKSelfContained)' != 'true'" Text="WindowsAppSDKSelfContained must be true." />
  </Target>

</Project>
